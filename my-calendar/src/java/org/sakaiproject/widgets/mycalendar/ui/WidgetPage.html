<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:wicket="http://wicket.apache.org/dtds.data/wicket-xhtml1.4-strict.dtd" >
 
<head>
	<title><wicket:message key="app.title" /></title>
</head>     
<body>

<!-- TODO may need a way to namespace all of this, aka uPortal style? For now just look it up and assume one per page -->

<!--  TOOD change these to classes, see data below -->
<div id="calendar"></div>
<div id="events"></div>

<!-- Wicket loads some pieces of data into this container which can be looked up by the Javascript -->
<div class="my-calendar-data" wicket:id="data">This holds data</div>

<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
<script type="text/javascript">

var Event = function(date, title, type, duration) {
    this.date = date;
    this.title = title;
    this.type = type;
    this.duration = duration;
};

jQuery.ajax({
    url: '/direct/calendar/site/14d3529e-da64-475a-b70f-765c2ed8bb50.json',
    success: function (result) {
        eventList = result.calendar_collection;
    },
    async: false
});

console.dir(events);

$("#calendar").datepicker({
    beforeShowDay: function(date) {
    	var events = getEventsForDate(date);
		if (events.length > 0) {
            return [true, "eventful-day", getTextForDate(date, events)];
        }
        else {
            return [true, '', ''];
        } 
    },
     onSelect: function(date) {
   		$("#events").text(getTextForDate(new Date(date), getEventsForDate(new Date(date))));
    } 
});

function getEventsForDate(date) {
	var events = [];
	for (i = 0; i < eventList.length; i++) {
		eventDate = new Date(eventList[i].firstTime.display);
		if (eventDate.getFullYear() === date.getFullYear() &&
				eventDate.getMonth() === date.getMonth() &&
				eventDate.getDate() === date.getDate()) {
			events.push(new Event(eventDate, eventList[i].title, eventList[i].type, eventList[i].duration));
		}
	}
	return events;
}

function getTextForDate(date, events) {
	var textToDisplay = events[0].type +  ': ' + events[0].title;
   	if (events.length > 1) {
   		for (i = 1; i < events.length; i++) {
   			textToDisplay = textToDisplay.concat("\n" + events[i].type + ": " + events[i].title);
   		}
   	}
   	return textToDisplay;
}

</script>

</body>
</html>